<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Administrador - SENA</title>
    <link rel="stylesheet" href="/css/administrador-dashboard.css">
    <!-- Chart.js para gr√°ficos din√°micos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="logo">
                <img src="/img/logo2.png" alt="Logo SENA" style="width: 80px; height: 80px; margin-bottom: 15px; object-fit: contain;">
                <h2>Administrador</h2>
            </div>
            <ul class="nav-menu">
                <li data-section="dashboard" class="nav-item active">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="12" width="4" height="8"></rect>
                        <rect x="10" y="4" width="4" height="16"></rect>
                        <rect x="17" y="2" width="4" height="18"></rect>
                    </svg>
                    Dashboard
                </li>
                <li data-section="usuarios" class="nav-item">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    Usuarios
                </li>
                <li data-section="aprendices" class="nav-item">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    Aprendices
                </li>
                <li data-section="instructores" class="nav-item">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    Instructores
                </li>
                <li data-section="fichas" class="nav-item">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 19.5h16M6 12.5h12M6 16.5h12M4 8.5h16M4 4h16a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z"></path>
                    </svg>
                    Fichas
                </li>
                <li data-section="trimestres" class="nav-item">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    Trimestres
                </li>
                <li data-section="reportes-admin" class="nav-item">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                         <path d="M21 21H3V3h9V1H3a2 2 0 0 0-2 2v18a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2v-9h-2v9z"></path>
                         <polyline points="17 1 21 1 21 5"></polyline>
                         <polyline points="11 15 21 5"></polyline>
                     </svg>
                    Reportes
                </li>
                <li data-section="roles" class="nav-item">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                    </svg>
                    Roles
                </li>
                <li data-section="configuracion" class="nav-item">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M12 1v6m0 6v6M4.22 4.22l4.24 4.24m0 5.08l-4.24 4.24M1 12h6m6 0h6M4.22 19.78l4.24-4.24m5.08 0l4.24 4.24M19.78 19.78l-4.24-4.24m0-5.08l4.24-4.24M23 12h-6m-6 0H5"></path>
                    </svg>
                    Configuraci√≥n
                </li>
            </ul>
        </div>

        <div class="main-content">
             <!-- Header -->
             <div class="header">
                 <div class="search-box">
                     <input type="text" id="global-search" placeholder="Buscar en todo...">
                 </div>
                 <img src="/img/logo_sena.png" alt="Logo SENA" style="height: 50px; object-fit: contain; margin: 0 15px;">
                 <div class="header-actions">
                     <button class="btn-icon" onclick="toggleTheme()" title="Tema">
                         <span class="icon">üåó</span>
                     </button>
                     <div class="user-profile-header" style="display: flex; align-items: center; gap: 10px; cursor: pointer;" onclick="openModal('modal-editar-foto-perfil')" title="Editar foto de perfil">
                         <div id="user-avatar-container" class="user-avatar" style="width: 40px; height: 40px; border-radius: 50%; background: #FF9800; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; position: relative; overflow: hidden; transition: all 0.3s;">
                             <img id="user-avatar-img" src="" alt="Foto" style="width: 100%; height: 100%; object-fit: cover; display: none;">
                             <span id="user-initials">?</span>
                         </div>
                         <span id="user-name" class="user-name">Usuario</span>
                     </div>
                     <button class="btn-action btn-danger" onclick="logout()" title="Cerrar sesi√≥n">
                         CERRAR SESI√ìN
                     </button>
                 </div>
             </div>

            <!-- Panel de Notificaciones -->
            <div id="notification-panel" class="notification-panel">
                <h3>Notificaciones del Sistema</h3>
                <div id="notificaciones-list"></div>
            </div>

            <!-- Dashboard Section -->
            <div id="dashboard" class="section active">
                <h1>Dashboard Administrativo</h1>
                <div id="dashboard-grid" class="dashboard-grid"></div>
                
                <!-- Secci√≥n de Gr√°ficos Administrativos -->
                <div style="margin-top: 40px;">
                    <h2>Estad√≠sticas del Sistema</h2>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; margin-top: 20px;">
                         <!-- Gr√°fico de Usuarios por Rol -->
                         <div class="chart-container">
                             <h3>Distribuci√≥n de Usuarios por Rol</h3>
                             <canvas id="usuariosRolChart"></canvas>
                         </div>
                         
                         <!-- Gr√°fico de Fichas Activas -->
                         <div class="chart-container">
                             <h3>Estado de Fichas</h3>
                             <canvas id="fichasEstadoChart"></canvas>
                         </div>
                         
                         <!-- Gr√°fico de Aprendices por Ficha -->
                         <div class="chart-container">
                             <h3>Aprendices por Ficha</h3>
                             <canvas id="aprendicesFichaChart"></canvas>
                         </div>
                         
                         <!-- Gr√°fico de Trimestres -->
                         <div class="chart-container">
                             <h3>Trimestres Activos</h3>
                             <canvas id="trimestresChart"></canvas>
                         </div>
                         
                         <!-- Gr√°fico de Evaluaciones -->
                         <div class="chart-container">
                             <h3>Calificaciones Promedio por Ficha</h3>
                             <canvas id="evaluacionesFichaChart"></canvas>
                         </div>
                         
                         <!-- Gr√°fico de GAES -->
                         <div class="chart-container">
                             <h3>Miembros por GAES</h3>
                             <canvas id="gaesChart"></canvas>
                         </div>
                     </div>
                </div>
                
                <div id="dashboard-charts" class="charts-grid" style="display: none;">
                    <canvas id="chartUsuarios"></canvas>
                    <canvas id="chartFichas"></canvas>
                </div>
            </div>

            <!-- Usuarios -->
            <div id="usuarios" class="section">
                <h1>Gestionar Usuarios</h1>
                <button class="btn-primary" onclick="llenarSelectRoles('usuario-rol'); openModal('modal-crear-usuario')">
                    + Nuevo Usuario
                </button>
                <div class="filters">
                    <input type="text" id="usuarios-search" placeholder="Buscar usuario...">
                    <select id="usuarios-rol-filter">
                        <option value="">Todos los roles</option>
                    </select>
                    <select id="usuarios-estado-filter">
                        <option value="">Todos los estados</option>
                        <option value="ACTIVO">Activo</option>
                        <option value="INACTIVO">Inactivo</option>
                    </select>
                </div>
                <div id="usuarios-list" class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nombre</th>
                                <th>Apellido</th>
                                <th>Correo</th>
                                <th>Tipo Documento</th>
                                <th>Documento</th>
                                <th>Rol</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="usuarios-tbody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Aprendices -->
            <div id="aprendices" class="section">
                <h1>Lista de Aprendices</h1>
                <button class="btn-primary" onclick="llenarSelectUsuariosAprendices(); llenarSelectFichasAprendices(); openModal('modal-crear-aprendiz')">
                    Nuevo Aprendiz
                </button>
                <div class="filters">
                    <input type="text" id="aprendices-search" placeholder="Buscar por nombre de usuario...">
                    <select id="aprendices-ficha-filter">
                        <option value="">Todas las fichas</option>
                    </select>
                    <select id="aprendices-estado-filter">
                        <option value="">Todos los estados</option>
                        <option value="ACTIVO">Activo</option>
                        <option value="INACTIVO">Inactivo</option>
                    </select>
                </div>
                <div id="aprendices-list" class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Usuario</th>
                                <th>Ficha</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="aprendices-tbody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Instructores -->
            <div id="instructores" class="section">
                <h1>Lista de Instructores</h1>
                <button class="btn-primary" onclick="llenarSelectUsuarios(); llenarSelectFichasInstructores(); openModal('modal-crear-instructor')">
                    Nuevo Instructor
                </button>
                <div class="filters">
                    <input type="text" id="instructores-search" placeholder="Buscar instructor...">
                </div>
                <div id="instructores-list" class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Usuario</th>
                                <th>Ficha a Cargo</th>
                                <th>Especialidad</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="instructores-tbody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Fichas -->
            <div id="fichas" class="section">
                <h1>Gestionar Fichas</h1>
                <button class="btn-primary" onclick="openModal('modal-crear-ficha')">
                    + Nueva Ficha
                </button>
                <div class="filters">
                    <input type="text" id="fichas-search" placeholder="Buscar ficha...">
                    <select id="fichas-estado-filter">
                        <option value="">Todos los estados</option>
                        <option value="ACTIVO">Activa</option>
                        <option value="INACTIVO">Inactiva</option>
                        <option value="FINALIZADO">Finalizada</option>
                    </select>
                </div>
                <div id="fichas-list" class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>C√≥digo</th>
                                <th>Programa</th>
                                <th>Jornada</th>
                                <th>Modalidad</th>
                                <th>Fecha Inicio</th>
                                <th>Fecha Fin</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="fichas-tbody">
                        </tbody>
                    </table>
                </div>
            </div>



            <!-- Trimestres -->
            <div id="trimestres" class="section">
                <h1>Gestionar Trimestres</h1>
                <button class="btn-primary" onclick="openModal('modal-crear-trimestre')">
                    + Nuevo Trimestre
                </button>
                <div class="filters">
                    <input type="text" id="trimestres-search" placeholder="Buscar trimestre...">
                    <select id="trimestres-ficha-filter">
                        <option value="">Todas las fichas</option>
                    </select>
                    <select id="trimestres-estado-filter">
                        <option value="">Todos los estados</option>
                        <option value="ACTIVO">Activo</option>
                        <option value="INACTIVO">Inactivo</option>
                        <option value="FINALIZADO">Finalizado</option>
                    </select>
                </div>
                <div id="trimestres-list" class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>N√∫mero</th>
                                <th>Ficha</th>
                                <th>Programa</th>
                                <th>Fecha Inicio</th>
                                <th>Fecha Fin</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="trimestres-tbody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Evaluaciones -->
            <div id="evaluaciones" class="section">
                <h1>Gestionar Reportes</h1>
                <div style="display: flex; gap: 10px; margin-bottom: 20px; align-items: center;">
                    <button class="btn-primary" onclick="openModal('modal-crear-evaluacion')">
                         + Nuevo Reporte
                      </button>
                    <button class="btn-secondary" style="background-color: #d32f2f; color: white; display: flex; align-items: center; gap: 8px;" onclick="descargarEvaluacionesPDF()">
                        üìÑ Descargar PDF
                    </button>
                    <button class="btn-secondary" style="background-color: #388e3c; color: white; display: flex; align-items: center; gap: 8px;" onclick="descargarEvaluacionesExcel()">
                        üìä Descargar Excel
                    </button>
                </div>
                <div class="filters">
                    <input type="text" id="evaluaciones-search" placeholder="Buscar evaluaci√≥n...">
                    <select id="evaluaciones-gaes-filter">
                        <option value="">Todos los GAES</option>
                    </select>
                    <select id="evaluaciones-evaluador-filter">
                        <option value="">Todos los evaluadores</option>
                    </select>
                </div>
                <div id="evaluaciones-list" class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Aprendiz</th>
                                <th>GAES</th>
                                <th>Evaluador</th>
                                <th>Calificaci√≥n</th>
                                <th>Fecha</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="evaluaciones-tbody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Reportes Administrativos -->
            <div id="reportes-admin" class="section">
                <h1>Reportes del Sistema</h1>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 30px;">
                    <button class="btn-primary" style="padding: 15px; text-align: left; height: auto;" onclick="goToSection('reporte-usuarios')">
                        üìã Reporte de Usuarios<br><small>Usuarios, roles y estados</small>
                    </button>
                    <button class="btn-primary" style="padding: 15px; text-align: left; height: auto;" onclick="goToSection('reporte-fichas')">
                        üìö Fichas y Aprendices<br><small>Fichas con sus aprendices</small>
                    </button>
                    <button class="btn-primary" style="padding: 15px; text-align: left; height: auto;" onclick="goToSection('reporte-instructores')">
                        üë®‚Äçüè´ Reporte de Instructores<br><small>Instructores y especialidades</small>
                    </button>
                    <button class="btn-primary" style="padding: 15px; text-align: left; height: auto;" onclick="goToSection('reporte-trimestres')">
                        üìÖ Trimestres por Ficha<br><small>Trimestres por ficha</small>
                    </button>
                    <button class="btn-primary" style="padding: 15px; text-align: left; height: auto;" onclick="goToSection('reporte-proyectos')">
                        üéØ Proyectos por GAES<br><small>Proyectos y GAES</small>
                    </button>
                </div>
            </div>

            <!-- Reporte Usuarios -->
            <div id="reporte-usuarios" class="section">
                <h1>Reporte de Usuarios</h1>
                <div style="margin-bottom: 15px;">
                    <button class="btn-secondary" onclick="goToSection('reportes-admin')" style="margin-right: 10px;">‚Üê Volver</button>
                    <button class="btn-primary" style="background-color: #d32f2f; color: white; margin-right: 10px;" onclick="descargarReporteUsuariosPDF()">üìÑ Descargar PDF</button>
                    <button class="btn-primary" style="background-color: #388e3c; color: white;" onclick="descargarReporteUsuariosExcel()">üìä Descargar Excel</button>
                </div>
                <div class="filters">
                    <input type="text" id="reporte-usuarios-search" placeholder="Buscar usuario...">
                    <select id="reporte-usuarios-rol-filter">
                        <option value="">Todos los roles</option>
                    </select>
                    <select id="reporte-usuarios-estado-filter">
                        <option value="">Todos los estados</option>
                        <option value="ACTIVO">Activo</option>
                        <option value="INACTIVO">Inactivo</option>
                    </select>
                </div>
                <div id="reporte-usuarios-list" class="table-container"></div>
            </div>

            <!-- Reporte Fichas -->
            <div id="reporte-fichas" class="section">
                <h1>Reporte de Fichas con Aprendices</h1>
                <div style="margin-bottom: 15px;">
                    <button class="btn-secondary" onclick="goToSection('reportes-admin')" style="margin-right: 10px;">‚Üê Volver</button>
                    <button class="btn-primary" style="background-color: #d32f2f; color: white; margin-right: 10px;" onclick="descargarReporteFichasPDF()">üìÑ Descargar PDF</button>
                    <button class="btn-primary" style="background-color: #388e3c; color: white;" onclick="descargarReporteFichasExcel()">üìä Descargar Excel</button>
                </div>
                <div class="filters">
                    <input type="text" id="fichas-search" placeholder="Buscar ficha..." oninput="filtrarPorFicha()">
                    <select id="fichas-selector" onchange="filtrarPorFicha()">
                        <option value="">Todas las fichas</option>
                    </select>
                    <select id="fichas-estado-filter" onchange="filtrarPorFicha()">
                        <option value="">Todos los estados</option>
                        <option value="ACTIVO">Activa</option>
                        <option value="INACTIVO">Inactiva</option>
                        <option value="FINALIZADO">Finalizada</option>
                    </select>
                </div>
                <div id="reporte-fichas-list" class="table-container"></div>
            </div>

            <!-- Reporte Instructores -->
            <div id="reporte-instructores" class="section">
                <h1>Reporte de Instructores</h1>
                <div style="margin-bottom: 15px;">
                    <button class="btn-secondary" onclick="goToSection('reportes-admin')" style="margin-right: 10px;">‚Üê Volver</button>
                    <button class="btn-primary" style="background-color: #d32f2f; color: white; margin-right: 10px;" onclick="descargarReporteInstructoresPDF()">üìÑ Descargar PDF</button>
                    <button class="btn-primary" style="background-color: #388e3c; color: white;" onclick="descargarReporteInstructoresExcel()">üìä Descargar Excel</button>
                </div>
                <div class="filters">
                    <input type="text" id="instructores-search" placeholder="Buscar instructor...">
                    <select id="instructores-estado-filter">
                        <option value="">Todos los estados</option>
                        <option value="ACTIVO">Activo</option>
                        <option value="INACTIVO">Inactivo</option>
                    </select>
                </div>
                <div id="reporte-instructores-list" class="table-container"></div>
            </div>

            <!-- Reporte Trimestres -->
            <div id="reporte-trimestres" class="section">
                <h1>Reporte de Trimestres por Ficha</h1>
                <div style="margin-bottom: 15px;">
                    <button class="btn-secondary" onclick="goToSection('reportes-admin')" style="margin-right: 10px;">‚Üê Volver</button>
                    <button class="btn-primary" style="background-color: #d32f2f; color: white; margin-right: 10px;" onclick="descargarReporteTrimestres PDF()">üìÑ Descargar PDF</button>
                    <button class="btn-primary" style="background-color: #388e3c; color: white;" onclick="descargarReporteTrimestresExcel()">üìä Descargar Excel</button>
                </div>
                <div class="filters">
                     <input type="text" id="trimestres-search" placeholder="Buscar ficha..." oninput="filtrarPorFichaTrimestres()">
                     <select id="trimestres-ficha-selector" onchange="filtrarPorFichaTrimestres()">
                         <option value="">Todas las fichas</option>
                     </select>
                     <select id="trimestres-estado-filter" onchange="filtrarPorFichaTrimestres()">
                         <option value="">Todos los estados</option>
                         <option value="ACTIVO">Activo</option>
                         <option value="INACTIVO">Inactivo</option>
                         <option value="FINALIZADO">Finalizado</option>
                     </select>
                 </div>
                 <div id="reporte-trimestres-list" class="table-container"></div>
                </div>

            <!-- Reporte Proyectos -->
            <div id="reporte-proyectos" class="section">
                <h1>Reporte de Proyectos por GAES</h1>
                <div style="margin-bottom: 15px;">
                    <button class="btn-secondary" onclick="goToSection('reportes-admin')" style="margin-right: 10px;">‚Üê Volver</button>
                    <button class="btn-primary" style="background-color: #d32f2f; color: white; margin-right: 10px;" onclick="descargarReporteProyectosPDF()">üìÑ Descargar PDF</button>
                    <button class="btn-primary" style="background-color: #388e3c; color: white;" onclick="descargarReporteProyectosExcel()">üìä Descargar Excel</button>
                </div>
                <div class="filters">
                    <input type="text" id="proyectos-search" placeholder="Buscar GAES o proyecto..." oninput="filtrarPorGaes()">
                    <select id="proyectos-gaes-selector" onchange="filtrarPorGaes()">
                        <option value="">Todos los GAES</option>
                    </select>
                    <select id="proyectos-estado-filter" onchange="filtrarPorGaes()">
                        <option value="">Todos los estados</option>
                        <option value="en_proceso">En Proceso</option>
                        <option value="finalizado">Finalizado</option>
                        <option value="cancelado">Cancelado</option>
                    </select>
                </div>
                <div id="reporte-proyectos-list" class="table-container"></div>
                </div>

            <!-- Roles -->
            <div id="roles" class="section">
                <h1>Gestionar Roles</h1>
                <button class="btn-primary" onclick="openModal('modal-crear-rol')">
                    + Nuevo Rol
                </button>
                <div class="filters" style="margin-top: 15px;">
                    <input type="text" id="roles-search" placeholder="Buscar rol...">
                </div>
                <div id="roles-list" class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nombre del Rol</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="roles-tbody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Configuraci√≥n -->
            <div id="configuracion" class="section">
                <h1>Configuraci√≥n del Sistema</h1>
                <div class="settings-grid">
                    <button class="btn-secondary" onclick="openModal('modal-cambiar-contrasena')">
                        üîê Cambiar Contrase√±a
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALES -->
    <!-- Modal Crear Usuario -->
    <div id="modal-crear-usuario" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Crear Usuario</h2>
                <button class="modal-close" onclick="closeModal('modal-crear-usuario')">&times;</button>
            </div>
            <form id="form-crear-usuario" class="form-group" onsubmit="crearUsuario(event)">
                <label>Nombre *</label>
                <input type="text" id="usuario-nombre" required>
                
                <label>Apellido *</label>
                <input type="text" id="usuario-apellido" required>
                
                <label>Correo *</label>
                <input type="email" id="usuario-correo" required>
                
                <label>Tipo Documento *</label>
                <select id="usuario-tipo-documento" required>
                    <option value="">Seleccione</option>
                    <option value="CC">C√©dula de Ciudadan√≠a</option>
                    <option value="CE">C√©dula de Extranjer√≠a</option>
                    <option value="TI">Tarjeta de Identidad</option>
                    <option value="PA">Pasaporte</option>
                </select>
                
                <label>N√∫mero Documento (8-10 d√≠gitos) *</label>
                <div style="position: relative;">
                    <input type="text" id="usuario-numero-documento" placeholder="1234567890" required minlength="8" maxlength="10" pattern="\d{8,10}" title="Debe contener entre 8 y 10 d√≠gitos" oninput="validateDocumentoNumber()" style="padding-right: 35px;">
                    <button type="button" id="docStatusBtn" class="doc-status-btn doc-status-invalid" disabled title="Ingresa entre 8 y 10 d√≠gitos">
                        ‚úó
                    </button>
                </div>
                <small id="docErrorMsg" style="color: #dc3545; display: none; margin-top: 5px;"></small>
                
                <label>Contrase√±a *</label>
                <input type="password" id="usuario-contrasena" placeholder="M√≠nimo 8 caracteres" minlength="8" required>
                
                <label>Confirmar Contrase√±a *</label>
                <input type="password" id="usuario-contrasena-confirmacion" placeholder="Confirmar contrase√±a" minlength="8" required>
                
                <label>Rol *</label>
                <select id="usuario-rol" required>
                    <option value="">Seleccione rol</option>
                </select>
                
                <label>Estado</label>
                <select id="usuario-estado">
                    <option value="ACTIVO">Activo</option>
                    <option value="INACTIVO">Inactivo</option>
                </select>
                
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">Crear Usuario</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('modal-crear-usuario')">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Editar Usuario -->
    <div id="modal-editar-usuario" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Editar Usuario</h2>
                <button class="modal-close" onclick="closeModal('modal-editar-usuario')">&times;</button>
            </div>
            <form id="form-editar-usuario" class="form-group" onsubmit="actualizarUsuario(event)">
                <input type="hidden" id="usuario-id-edit">
                
                <label>Nombre *</label>
                <input type="text" id="usuario-nombre-edit" required>
                
                <label>Apellido *</label>
                <input type="text" id="usuario-apellido-edit" required>
                
                <label>Correo *</label>
                <input type="email" id="usuario-correo-edit" required>
                
                <label>Tipo Documento *</label>
                <select id="usuario-tipo-documento-edit" required>
                    <option value="">Seleccione</option>
                    <option value="CC">C√©dula de Ciudadan√≠a</option>
                    <option value="CE">C√©dula de Extranjer√≠a</option>
                    <option value="TI">Tarjeta de Identidad</option>
                    <option value="PA">Pasaporte</option>
                </select>
                
                <label>N√∫mero Documento (8-10 d√≠gitos) *</label>
                <div style="position: relative;">
                    <input type="text" id="usuario-numero-documento-edit" placeholder="1234567890" required minlength="8" maxlength="10" pattern="\d{8,10}" title="Debe contener entre 8 y 10 d√≠gitos" oninput="validateDocumentoNumberEdit()" style="padding-right: 35px;">
                    <button type="button" id="docStatusBtnEdit" class="doc-status-btn doc-status-invalid" disabled title="Ingresa entre 8 y 10 d√≠gitos">
                        ‚úó
                    </button>
                </div>
                <small id="docErrorMsgEdit" style="color: #dc3545; display: none; margin-top: 5px;"></small>
                
                <label>Rol *</label>
                <select id="usuario-rol-edit" required>
                    <option value="">Seleccione rol</option>
                </select>
                
                <label>Estado</label>
                <select id="usuario-estado-edit">
                    <option value="ACTIVO">Activo</option>
                    <option value="INACTIVO">Inactivo</option>
                </select>
                
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">Guardar Cambios</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('modal-editar-usuario')">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Crear Aprendiz -->
    <div id="modal-crear-aprendiz" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Crear Aprendiz</h2>
                <button class="modal-close" onclick="closeModal('modal-crear-aprendiz')">&times;</button>
            </div>
            <form id="form-crear-aprendiz" class="form-group" onsubmit="crearAprendiz(event)">
                <label>Usuario *</label>
                <select id="aprendiz-usuario" required>
                    <option value="">Seleccione usuario</option>
                </select>
                
                <label>Ficha (opcional - puede asignarse despu√©s)</label>
                <select id="aprendiz-ficha">
                    <option value="">Dejar vac√≠o para asignar despu√©s</option>
                </select>
                
                <label>Nivel de Formaci√≥n *</label>
                <select id="aprendiz-nivel" required>
                    <option value="">Seleccione nivel</option>
                    <option value="TECNICO">T√©cnico</option>
                    <option value="TECNOLOGO">Tecn√≥logo</option>
                </select>
                
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">Crear Aprendiz</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('modal-crear-aprendiz')">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Editar Aprendiz -->
    <div id="modal-editar-aprendiz" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Editar Aprendiz</h2>
                <button class="modal-close" onclick="closeModal('modal-editar-aprendiz')">&times;</button>
            </div>
            <form id="form-editar-aprendiz" class="form-group" onsubmit="actualizarAprendiz(event)">
                <input type="hidden" id="aprendiz-id-edit">
                
                <label>Usuario *</label>
                <select id="aprendiz-usuario-edit" required>
                    <option value="">Seleccione usuario</option>
                </select>
                
                <label>Ficha *</label>
                <select id="aprendiz-ficha-edit" required>
                    <option value="">Seleccione ficha</option>
                </select>
                
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">Guardar Cambios</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('modal-editar-aprendiz')">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Crear Ficha -->
    <div id="modal-crear-ficha" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Crear Ficha</h2>
                <button class="modal-close" onclick="closeModal('modal-crear-ficha')">&times;</button>
            </div>
            <form id="form-crear-ficha" class="form-group" onsubmit="crearFicha(event)">
                <label>C√≥digo Ficha *</label>
                <input type="text" id="ficha-codigo" placeholder="Ej: SENA-2024-001" required>
                
                <label>Programa de Formaci√≥n *</label>
                <input type="text" id="ficha-programa" required>
                
                <label>Jornada *</label>
                <select id="ficha-jornada" required>
                    <option value="">Seleccione</option>
                    <option value="MA√ëANA">Ma√±ana</option>
                    <option value="TARDE">Tarde</option>
                    <option value="NOCHE">Noche</option>
                    <option value="COMPLETA">Completa</option>
                </select>
                
                <label>Modalidad *</label>
                <select id="ficha-modalidad" required>
                    <option value="">Seleccione</option>
                    <option value="PRESENCIAL">Presencial</option>
                    <option value="VIRTUAL">Virtual</option>
                    <option value="HIBRIDA">H√≠brida</option>
                </select>
                
                <label>Nivel de Formaci√≥n *</label>
                <select id="ficha-nivel" required>
                    <option value="">Seleccione</option>
                    <option value="TECNICO">T√©cnico</option>
                    <option value="TECNOLOGO">Tecn√≥logo</option>
                </select>
                
                <label>Fecha Inicio *</label>
                <input type="date" id="ficha-inicio" required>
                
                <label>Fecha Fin *</label>
                <input type="date" id="ficha-fin" required>
                
                <label>Estado</label>
                <select id="ficha-estado">
                    <option value="ACTIVO">Activo</option>
                    <option value="INACTIVO">Inactivo</option>
                    <option value="FINALIZADO">Finalizado</option>
                </select>
                
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">Crear Ficha</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('modal-crear-ficha')">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Editar Ficha -->
    <div id="modal-editar-ficha" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Editar Ficha</h2>
                <button class="modal-close" onclick="closeModal('modal-editar-ficha')">&times;</button>
            </div>
            <form id="form-editar-ficha" class="form-group" onsubmit="actualizarFicha(event)">
                <input type="hidden" id="ficha-id-edit">
                
                <label>C√≥digo Ficha *</label>
                <input type="text" id="ficha-codigo-edit" required>
                
                <label>Programa de Formaci√≥n *</label>
                <input type="text" id="ficha-programa-edit" required>
                
                <label>Jornada *</label>
                <select id="ficha-jornada-edit" required>
                    <option value="">Seleccione</option>
                    <option value="MA√ëANA">Ma√±ana</option>
                    <option value="TARDE">Tarde</option>
                    <option value="NOCHE">Noche</option>
                    <option value="COMPLETA">Completa</option>
                </select>
                
                <label>Modalidad *</label>
                <select id="ficha-modalidad-edit" required>
                    <option value="">Seleccione</option>
                    <option value="PRESENCIAL">Presencial</option>
                    <option value="VIRTUAL">Virtual</option>
                    <option value="HIBRIDA">H√≠brida</option>
                </select>
                
                <label>Fecha Inicio *</label>
                <input type="date" id="ficha-inicio-edit" required>
                
                <label>Fecha Fin *</label>
                <input type="date" id="ficha-fin-edit" required>
                
                <label>Estado</label>
                <select id="ficha-estado-edit">
                    <option value="ACTIVO">Activo</option>
                    <option value="INACTIVO">Inactivo</option>
                    <option value="FINALIZADO">Finalizado</option>
                </select>
                
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">Guardar Cambios</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('modal-editar-ficha')">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>



    <!-- Modal Crear Evaluaci√≥n -->
    <div id="modal-crear-evaluacion" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Crear Reporte</h2>
                <button class="modal-close" onclick="closeModal('modal-crear-evaluacion')">&times;</button>
            </div>
            <form id="form-crear-evaluacion" class="form-group" onsubmit="crearEvaluacion(event)">
                <label>Aprendiz *</label>
                <select id="evaluacion-aprendiz" required>
                    <option value="">Seleccione aprendiz</option>
                </select>
                
                <label>GAES *</label>
                <select id="evaluacion-gaes" required>
                    <option value="">Seleccione GAES</option>
                </select>
                
                <label>Evaluador (Instructor) *</label>
                <select id="evaluacion-evaluador" required>
                    <option value="">Seleccione evaluador</option>
                </select>
                
                <label>Rango de Calificaci√≥n *</label>
                <select id="evaluacion-rango" required onchange="actualizarRangoCalificacion('evaluacion-calificacion', 'evaluacion-rango')">
                    <option value="">Seleccione rango</option>
                    <option value="5">0.00 - 5.00</option>
                    <option value="100">1 - 100</option>
                </select>
                
                <label>Calificaci√≥n *</label>
                <input type="number" id="evaluacion-calificacion" step="0.01" min="0" max="5" required>
                
                <label>Observaciones</label>
                <textarea id="evaluacion-observaciones" placeholder="Comentarios sobre el reporte" rows="3"></textarea>
                
                <label>Fecha *</label>
                <input type="date" id="evaluacion-fecha" required>
                
                <div class="modal-actions">
                     <button type="submit" class="btn-primary">Crear Reporte</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('modal-crear-evaluacion')">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Editar Evaluaci√≥n -->
    <div id="modal-editar-evaluacion" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Editar Evaluaci√≥n</h2>
                <button class="modal-close" onclick="closeModal('modal-editar-evaluacion')">&times;</button>
            </div>
            <form id="form-editar-evaluacion" class="form-group" onsubmit="actualizarEvaluacion(event)">
                <input type="hidden" id="evaluacion-id-edit">
                
                <label>Aprendiz *</label>
                <select id="evaluacion-aprendiz-edit" required>
                    <option value="">Seleccione aprendiz</option>
                </select>
                
                <label>GAES *</label>
                <select id="evaluacion-gaes-edit" required>
                    <option value="">Seleccione GAES</option>
                </select>
                
                <label>Evaluador (Instructor) *</label>
                <select id="evaluacion-evaluador-edit" required>
                    <option value="">Seleccione evaluador</option>
                </select>
                
                <label>Rango de Calificaci√≥n *</label>
                <select id="evaluacion-rango-edit" required onchange="actualizarRangoCalificacion('evaluacion-calificacion-edit', 'evaluacion-rango-edit')">
                    <option value="">Seleccione rango</option>
                    <option value="5">0.00 - 5.00</option>
                    <option value="100">1 - 100</option>
                </select>
                
                <label>Calificaci√≥n *</label>
                <input type="number" id="evaluacion-calificacion-edit" step="0.01" min="0" max="5" required>
                
                <label>Observaciones</label>
                <textarea id="evaluacion-observaciones-edit" rows="3"></textarea>
                
                <label>Fecha *</label>
                <input type="date" id="evaluacion-fecha-edit" required>
                
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">Guardar Cambios</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('modal-editar-evaluacion')">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Crear Trimestre -->
    <div id="modal-crear-trimestre" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Crear Trimestre</h2>
                <button class="modal-close" onclick="closeModal('modal-crear-trimestre')">&times;</button>
            </div>
            <form id="form-crear-trimestre" class="form-group" onsubmit="crearTrimestre(event)">
                <label>N√∫mero Trimestre *</label>
                <select id="trimestre-numero" required>
                    <option value="">Seleccione</option>
                    <option value="1">Trimestre 1</option>
                    <option value="2">Trimestre 2</option>
                    <option value="3">Trimestre 3</option>
                    <option value="4">Trimestre 4</option>
                </select>
                
                <label>Ficha *</label>
                <input type="text" id="trimestre-ficha-search" placeholder="Buscar ficha por c√≥digo o programa..." style="margin-bottom: 10px;">
                <select id="trimestre-ficha" required>
                    <option value="">Seleccione una ficha</option>
                </select>
                
                <label>Fecha Inicio *</label>
                <input type="date" id="trimestre-inicio" required>
                
                <label>Fecha Fin *</label>
                <input type="date" id="trimestre-fin" required>
                
                <label>Estado</label>
                <select id="trimestre-estado">
                    <option value="ACTIVO">Activo</option>
                    <option value="INACTIVO">Inactivo</option>
                    <option value="FINALIZADO">Finalizado</option>
                </select>
                
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">Crear Trimestre</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('modal-crear-trimestre')">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Editar Trimestre -->
    <div id="modal-editar-trimestre" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Editar Trimestre</h2>
                <button class="modal-close" onclick="closeModal('modal-editar-trimestre')">&times;</button>
            </div>
            <form id="form-editar-trimestre" class="form-group" onsubmit="actualizarTrimestre(event)">
                <input type="hidden" id="trimestre-id-edit">
                
                <label>N√∫mero Trimestre *</label>
                <select id="trimestre-numero-edit" required>
                    <option value="">Seleccione</option>
                    <option value="1">Trimestre 1</option>
                    <option value="2">Trimestre 2</option>
                    <option value="3">Trimestre 3</option>
                    <option value="4">Trimestre 4</option>
                </select>
                
                <label>Ficha *</label>
                <input type="text" id="trimestre-ficha-search-edit" placeholder="Buscar ficha por c√≥digo o programa..." style="margin-bottom: 10px;">
                <select id="trimestre-ficha-edit" required>
                    <option value="">Seleccione una ficha</option>
                </select>
                
                <label>Fecha Inicio *</label>
                <input type="date" id="trimestre-inicio-edit" required>
                
                <label>Fecha Fin *</label>
                <input type="date" id="trimestre-fin-edit" required>
                
                <label>Estado</label>
                <select id="trimestre-estado-edit">
                    <option value="ACTIVO">Activo</option>
                    <option value="INACTIVO">Inactivo</option>
                    <option value="FINALIZADO">Finalizado</option>
                </select>
                
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">Guardar Cambios</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('modal-editar-trimestre')">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>



    <!-- Modal Crear Instructor -->
    <div id="modal-crear-instructor" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Crear Instructor</h2>
                <button class="modal-close" onclick="closeModal('modal-crear-instructor')">&times;</button>
            </div>
            <form id="form-crear-instructor" class="form-group" onsubmit="crearInstructor(event)">
                <label>Usuario *</label>
                <select id="instructor-usuario" required>
                    <option value="">Seleccione un usuario</option>
                </select>
                
                <label>Ficha a Cargo *</label>
                <select id="instructor-ficha" required>
                    <option value="">Seleccione una ficha</option>
                </select>
                
                <label>Especialidad</label>
                <input type="text" id="instructor-especialidad" placeholder="Ej: Programaci√≥n, Redes, etc.">
                
                <label>Estado</label>
                <select id="instructor-estado">
                    <option value="ACTIVO">ACTIVO</option>
                    <option value="INACTIVO">INACTIVO</option>
                </select>
                
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">Crear Instructor</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('modal-crear-instructor')">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Editar Instructor -->
    <div id="modal-editar-instructor" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Editar Instructor</h2>
                <button class="modal-close" onclick="closeModal('modal-editar-instructor')">&times;</button>
            </div>
            <form id="form-editar-instructor" class="form-group" onsubmit="actualizarInstructor(event)">
                <input type="hidden" id="instructor-id-edit">
                
                <label>Usuario *</label>
                <select id="instructor-usuario-edit" required>
                    <option value="">Seleccione un usuario</option>
                </select>
                
                <label>Ficha a Cargo *</label>
                <select id="instructor-ficha-edit" required>
                    <option value="">Seleccione una ficha</option>
                </select>
                
                <label>Especialidad</label>
                <input type="text" id="instructor-especialidad-edit" placeholder="Ej: Programaci√≥n, Redes, etc.">
                
                <label>Estado</label>
                <select id="instructor-estado-edit">
                    <option value="ACTIVO">ACTIVO</option>
                    <option value="INACTIVO">INACTIVO</option>
                </select>
                
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">Guardar Cambios</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('modal-editar-instructor')">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Crear Rol -->
    <div id="modal-crear-rol" class="modal">
         <div class="modal-content">
             <div class="modal-header">
                 <h2>Crear Rol</h2>
                 <button class="modal-close" onclick="closeModal('modal-crear-rol')">&times;</button>
             </div>
             <form id="form-crear-rol" class="form-group" onsubmit="crearRol(event)">
                 <label>Nombre del Rol *</label>
                 <input type="text" id="rol-nombre" placeholder="Ej: Instructor, Coordinador, etc." required>
                 
                 <div class="modal-actions">
                     <button type="submit" class="btn-primary">Crear Rol</button>
                     <button type="button" class="btn-secondary" onclick="closeModal('modal-crear-rol')">
                         Cancelar
                     </button>
                 </div>
             </form>
         </div>
     </div>

    <!-- Modal Editar Rol -->
    <div id="modal-editar-rol" class="modal">
         <div class="modal-content">
             <div class="modal-header">
                 <h2>Editar Rol</h2>
                 <button class="modal-close" onclick="closeModal('modal-editar-rol')">&times;</button>
             </div>
             <form id="form-editar-rol" class="form-group" onsubmit="actualizarRol(event)">
                 <input type="hidden" id="rol-id-edit">
                 
                 <label>Nombre del Rol *</label>
                 <input type="text" id="rol-nombre-edit" required>
                 
                 <div class="modal-actions">
                     <button type="submit" class="btn-primary">Guardar Cambios</button>
                     <button type="button" class="btn-secondary" onclick="closeModal('modal-editar-rol')">
                         Cancelar
                     </button>
                 </div>
             </form>
         </div>
     </div>

    <!-- Modal Mi Perfil -->
    <div id="modal-mi-perfil" class="modal">
         <div class="modal-content" style="max-width: 600px;">
             <div class="modal-header">
                 <h2>Mi Perfil</h2>
                 <button class="modal-close" onclick="closeModal('modal-mi-perfil')">&times;</button>
             </div>
             <div style="padding: 20px;">
                 <div style="text-align: center; margin-bottom: 30px;">
                     <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 32px; font-weight: bold; margin: 0 auto; margin-bottom: 15px;" id="profile-avatar">JA</div>
                     <h3 id="profile-nombre">Cargando...</h3>
                     <p id="profile-correo" style="color: #666; margin: 5px 0;">Cargando...</p>
                     <p id="profile-rol" style="color: #999; font-size: 14px;">Cargando...</p>
                 </div>
                 
                 <form id="form-mi-perfil" class="form-group" onsubmit="actualizarMiPerfil(event)">
                     <label>Nombre *</label>
                     <input type="text" id="perfil-nombre" required>
                     
                     <label>Apellido *</label>
                     <input type="text" id="perfil-apellido" required>
                     
                     <label>Correo *</label>
                     <input type="email" id="perfil-correo" required>
                     
                     <label>Tipo Documento</label>
                     <select id="perfil-tipo-documento">
                         <option value="CC">C√©dula de Ciudadan√≠a</option>
                         <option value="CE">C√©dula de Extranjer√≠a</option>
                         <option value="TI">Tarjeta de Identidad</option>
                         <option value="PA">Pasaporte</option>
                     </select>
                     
                     <label>N√∫mero Documento</label>
                     <input type="number" id="perfil-numero-documento">
                     
                     <div class="modal-actions">
                         <button type="submit" class="btn-primary">Guardar Cambios</button>
                         <button type="button" class="btn-secondary" onclick="closeModal('modal-mi-perfil')">
                             Cancelar
                         </button>
                     </div>
                     </form>
                     </div>
                     </div>
                     </div>

    <!-- Modal Editar Foto de Perfil -->
    <div id="modal-editar-foto-perfil" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2>Cambiar Foto de Perfil</h2>
                <button class="modal-close" onclick="closeModal('modal-editar-foto-perfil')">&times;</button>
            </div>
            <form id="form-editar-foto" class="form-group" onsubmit="guardarFotoPerfil(event)">
                <div style="text-align: center; margin-bottom: 20px;">
                    <div id="foto-preview" style="width: 120px; height: 120px; border-radius: 50%; background: #FF9800; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; color: white; font-size: 48px; overflow: hidden;">
                        <img id="preview-img" src="" alt="Preview" style="width: 100%; height: 100%; object-fit: cover; display: none;">
                        <span id="preview-initials">?</span>
                    </div>
                </div>
                
                <label>Seleccionar Foto *</label>
                <input type="file" id="foto-archivo" accept="image/*" required onchange="previewFotoModal(event)" style="margin-bottom: 15px;">
                
                <small style="color: #666; display: block; margin-bottom: 15px;">
                    Formatos soportados: JPG, PNG, GIF (m√°ximo 5MB)
                </small>
                
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">Guardar Foto</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('modal-editar-foto-perfil')">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

          <!-- Cargar utilidades de API y autenticaci√≥n PRIMERO (antes de cualquier script inline) -->
          <script src="/js/api-utils.js"></script>
         
         <!-- Actualizar header con datos del usuario autenticado -->
         <script src="/js/actualizar-header-usuario.js"></script>

         <script>
            // Validar autenticaci√≥n antes de cargar el dashboard
            function validarAutenticacion() {
            const token = localStorage.getItem('jwtToken');
            const rol = localStorage.getItem('usuarioRol');
            
            console.log('Token:', token ? 'Existe' : 'No existe');
            console.log('Rol guardado:', rol);
            
            // Si no hay token, redirigir al login
            if (!token || !token.trim()) {
                console.log('No hay token, redirigiendo al login');
                window.location.href = '/login';
                return false;
            }
            
            // Validar que sea administrador (case-insensitive)
            if (rol && rol.toLowerCase() !== 'administrador') {
                console.log('Rol no permitido:', rol);
                window.location.href = '/login';
                return false;
            }
            
            console.log('‚úì Usuario administrador autenticado correctamente');
            return true;
        }
        
        // Ejecutar validaci√≥n
        validarAutenticacion();
        </script>

        <!-- Prevenci√≥n de Back Navigation - DEBE SER PRIMERO -->
        
        
        <!-- Cargar inicializaci√≥n global -->
        <script src="/js/app-init.js"></script>
     
     <!-- Gr√°ficos din√°micos administrativos -->
     <script src="/js/admin-charts.js"></script>
     
     <!-- Luego cargar los m√≥dulos CRUD -->
     <script src="/js/administrador-dashboard.js"></script>
     <script src="/js/admin-instructores.js"></script>
     <script src="/js/mi-perfil.js"></script>
     <script src="/js/usuarios-crud.js"></script>
     <!-- Librer√≠as para PDF y Excel -->
     <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.min.js"></script>
     <script src="/js/admin-reportes.js"></script>
    <script src="/js/fichas-crud.js"></script>
    <script src="/js/trimestres-crud.js"></script>
    <script src="/js/evaluaciones-crud.js"></script>
    <script src="/js/roles-crud.js"></script>
    <script src="/js/aprendiz-crud.js"></script>
    <script src="/js/instructores-crud.js"></script>

    <style>
        .doc-status-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: none;
            font-size: 11px;
            font-weight: bold;
            cursor: not-allowed;
            transition: all 0.3s ease;
            background: #f0f0f0;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }
        
        .doc-status-invalid {
            background: #dc3545 !important;
            color: #fff !important;
            border-color: #c82333 !important;
        }
        
        .doc-status-valid {
            background: #28a745 !important;
            color: #fff !important;
            border-color: #1e7e34 !important;
            cursor: default !important;
        }
    </style>

    <script>
        function validateDocumentoNumber() {
            const numeroDocumento = document.getElementById('usuario-numero-documento').value;
            const docErrorMsg = document.getElementById('docErrorMsg');
            const docStatusBtn = document.getElementById('docStatusBtn');
            
            // Solo permitir d√≠gitos
            const soloDigitos = numeroDocumento.replace(/\D/g, '');
            document.getElementById('usuario-numero-documento').value = soloDigitos;
            
            if (soloDigitos.length < 8) {
                docErrorMsg.textContent = 'M√≠nimo 8 d√≠gitos requeridos';
                docErrorMsg.style.display = 'block';
                docStatusBtn.textContent = '‚úó';
                docStatusBtn.classList.remove('doc-status-valid');
                docStatusBtn.classList.add('doc-status-invalid');
                docStatusBtn.title = 'N√∫mero de documento inv√°lido (m√≠nimo 8 d√≠gitos)';
            } else if (soloDigitos.length > 10) {
                docErrorMsg.textContent = 'M√°ximo 10 d√≠gitos permitidos';
                docErrorMsg.style.display = 'block';
                docStatusBtn.textContent = '‚úó';
                docStatusBtn.classList.remove('doc-status-valid');
                docStatusBtn.classList.add('doc-status-invalid');
                docStatusBtn.title = 'N√∫mero de documento inv√°lido (m√°ximo 10 d√≠gitos)';
            } else {
                docErrorMsg.style.display = 'none';
                docStatusBtn.textContent = '‚úì';
                docStatusBtn.classList.remove('doc-status-invalid');
                docStatusBtn.classList.add('doc-status-valid');
                docStatusBtn.title = 'N√∫mero de documento v√°lido';
            }
        }

        function validateDocumentoNumberEdit() {
            const numeroDocumento = document.getElementById('usuario-numero-documento-edit').value;
            const docErrorMsg = document.getElementById('docErrorMsgEdit');
            const docStatusBtn = document.getElementById('docStatusBtnEdit');
            
            // Solo permitir d√≠gitos
            const soloDigitos = numeroDocumento.replace(/\D/g, '');
            document.getElementById('usuario-numero-documento-edit').value = soloDigitos;
            
            if (soloDigitos.length < 8) {
                docErrorMsg.textContent = 'M√≠nimo 8 d√≠gitos requeridos';
                docErrorMsg.style.display = 'block';
                docStatusBtn.textContent = '‚úó';
                docStatusBtn.classList.remove('doc-status-valid');
                docStatusBtn.classList.add('doc-status-invalid');
                docStatusBtn.title = 'N√∫mero de documento inv√°lido (m√≠nimo 8 d√≠gitos)';
            } else if (soloDigitos.length > 10) {
                docErrorMsg.textContent = 'M√°ximo 10 d√≠gitos permitidos';
                docErrorMsg.style.display = 'block';
                docStatusBtn.textContent = '‚úó';
                docStatusBtn.classList.remove('doc-status-valid');
                docStatusBtn.classList.add('doc-status-invalid');
                docStatusBtn.title = 'N√∫mero de documento inv√°lido (m√°ximo 10 d√≠gitos)';
            } else {
                docErrorMsg.style.display = 'none';
                docStatusBtn.textContent = '‚úì';
                docStatusBtn.classList.remove('doc-status-invalid');
                docStatusBtn.classList.add('doc-status-valid');
                docStatusBtn.title = 'N√∫mero de documento v√°lido';
            }
        }
    </script>
    </body>
    </html>
