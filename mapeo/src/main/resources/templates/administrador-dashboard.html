<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Administrador - SENA</title>
    <link rel="stylesheet" href="/css/administrador-dashboard.css">
    <!-- Chart.js para gr√°ficos din√°micos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="logo">
                <img src="/img/logo2.png" alt="Logo SENA" style="width: 80px; height: 80px; margin-bottom: 15px; object-fit: contain;">
                <h2>‚öôÔ∏è Administrador</h2>
            </div>
            <ul class="nav-menu">
                <li data-section="dashboard" class="nav-item active">
                    <span class="icon">üìä</span> Dashboard
                </li>
                <li data-section="usuarios" class="nav-item">
                    <span class="icon">üë•</span> Usuarios
                </li>
                <li data-section="aprendices" class="nav-item">
                    <span class="icon">üë®‚Äçüéì</span> Aprendices
                </li>
                <li data-section="instructores" class="nav-item">
                    <span class="icon">üë®‚Äçüè´</span> Instructores
                </li>
                <li data-section="fichas" class="nav-item">
                     <span class="icon">üìö</span> Fichas
                 </li>
                 <li data-section="trimestres" class="nav-item">
                    <span class="icon">üìÖ</span> Trimestres
                </li>
                <li data-section="evaluaciones" class="nav-item">
                    <span class="icon">üìä</span> Reportes
                </li>
                <li data-section="roles" class="nav-item">
                    <span class="icon">üîê</span> Roles
                </li>
                <li data-section="configuracion" class="nav-item">
                    <span class="icon">‚öôÔ∏è</span> Configuraci√≥n
                </li>
            </ul>
        </div>

        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <div class="search-box">
                    <input type="text" id="global-search" placeholder="Buscar en todo...">
                </div>
                <div class="header-actions">
                    <button class="btn-icon" onclick="toggleTheme()" title="Tema">
                        <span class="icon">üåó</span>
                    </button>
                    <div class="user-profile-header">
                        <button class="btn-user-profile" onclick="openModal('modal-mi-perfil')" title="Mi Perfil">
                            <span id="user-initials" class="user-avatar">JA</span>
                            <span id="user-name" class="user-name">Administrador</span>
                        </button>
                    </div>
                    <button class="btn-action btn-danger" onclick="logout()" title="Cerrar sesi√≥n">
                        CERRAR SESI√ìN
                    </button>
                </div>
            </div>

            <!-- Panel de Notificaciones -->
            <div id="notification-panel" class="notification-panel">
                <h3>Notificaciones del Sistema</h3>
                <div id="notificaciones-list"></div>
            </div>

            <!-- Dashboard Section -->
            <div id="dashboard" class="section active">
                <h1>Dashboard Administrativo</h1>
                <div id="dashboard-grid" class="dashboard-grid"></div>
                
                <!-- Secci√≥n de Gr√°ficos Administrativos -->
                <div style="margin-top: 40px;">
                    <h2>Estad√≠sticas del Sistema</h2>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; margin-top: 20px;">
                        <!-- Gr√°fico de Usuarios por Rol -->
                        <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <h3>Distribuci√≥n de Usuarios por Rol</h3>
                            <canvas id="usuariosRolChart"></canvas>
                        </div>
                        
                        <!-- Gr√°fico de Fichas Activas -->
                        <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <h3>Estado de Fichas</h3>
                            <canvas id="fichasEstadoChart"></canvas>
                        </div>
                        
                        <!-- Gr√°fico de Aprendices por Ficha -->
                        <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <h3>Aprendices por Ficha</h3>
                            <canvas id="aprendicesFichaChart"></canvas>
                        </div>
                        
                        <!-- Gr√°fico de Trimestres -->
                        <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <h3>Trimestres Activos</h3>
                            <canvas id="trimestresChart"></canvas>
                        </div>
                        
                        <!-- Gr√°fico de Evaluaciones -->
                        <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <h3>Calificaciones Promedio por Ficha</h3>
                            <canvas id="evaluacionesFichaChart"></canvas>
                        </div>
                        
                        <!-- Gr√°fico de GAES -->
                        <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <h3>Miembros por GAES</h3>
                            <canvas id="gaesChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div id="dashboard-charts" class="charts-grid" style="display: none;">
                    <canvas id="chartUsuarios"></canvas>
                    <canvas id="chartFichas"></canvas>
                </div>
            </div>

            <!-- Usuarios -->
            <div id="usuarios" class="section">
                <h1>Gestionar Usuarios</h1>
                <button class="btn-primary" onclick="llenarSelectRoles('usuario-rol'); openModal('modal-crear-usuario')">
                    + Nuevo Usuario
                </button>
                <div class="filters">
                    <input type="text" id="usuarios-search" placeholder="Buscar usuario...">
                    <select id="usuarios-rol-filter">
                        <option value="">Todos los roles</option>
                    </select>
                    <select id="usuarios-estado-filter">
                        <option value="">Todos los estados</option>
                        <option value="ACTIVO">Activo</option>
                        <option value="INACTIVO">Inactivo</option>
                    </select>
                </div>
                <div id="usuarios-list" class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nombre</th>
                                <th>Apellido</th>
                                <th>Correo</th>
                                <th>Tipo Documento</th>
                                <th>Documento</th>
                                <th>Rol</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="usuarios-tbody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Aprendices -->
            <div id="aprendices" class="section">
                <h1>Lista de Aprendices</h1>
                <button class="btn-primary" onclick="llenarSelectUsuariosAprendices(); llenarSelectFichasAprendices(); openModal('modal-crear-aprendiz')">
                    Nuevo Aprendiz
                </button>
                <div id="aprendices-list" class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Usuario</th>
                                <th>Ficha</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="aprendices-tbody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Instructores -->
            <div id="instructores" class="section">
                <h1>Lista de Instructores</h1>
                <button class="btn-primary" onclick="llenarSelectUsuarios(); llenarSelectFichasInstructores(); openModal('modal-crear-instructor')">
                    Nuevo Instructor
                </button>
                <div class="filters">
                    <input type="text" id="instructores-search" placeholder="Buscar instructor...">
                </div>
                <div id="instructores-list" class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Usuario</th>
                                <th>Ficha a Cargo</th>
                                <th>Especialidad</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="instructores-tbody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Fichas -->
            <div id="fichas" class="section">
                <h1>Gestionar Fichas</h1>
                <button class="btn-primary" onclick="openModal('modal-crear-ficha')">
                    + Nueva Ficha
                </button>
                <div class="filters">
                    <input type="text" id="fichas-search" placeholder="Buscar ficha...">
                    <select id="fichas-estado-filter">
                        <option value="">Todos los estados</option>
                        <option value="ACTIVO">Activa</option>
                        <option value="INACTIVO">Inactiva</option>
                        <option value="FINALIZADO">Finalizada</option>
                    </select>
                </div>
                <div id="fichas-list" class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>C√≥digo</th>
                                <th>Programa</th>
                                <th>Jornada</th>
                                <th>Modalidad</th>
                                <th>Fecha Inicio</th>
                                <th>Fecha Fin</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="fichas-tbody">
                        </tbody>
                    </table>
                </div>
            </div>



            <!-- Trimestres -->
            <div id="trimestres" class="section">
                <h1>Gestionar Trimestres</h1>
                <button class="btn-primary" onclick="openModal('modal-crear-trimestre')">
                    + Nuevo Trimestre
                </button>
                <div class="filters">
                    <input type="text" id="trimestres-search" placeholder="Buscar trimestre...">
                    <select id="trimestres-ficha-filter">
                        <option value="">Todas las fichas</option>
                    </select>
                    <select id="trimestres-estado-filter">
                        <option value="">Todos los estados</option>
                        <option value="ACTIVO">Activo</option>
                        <option value="INACTIVO">Inactivo</option>
                        <option value="FINALIZADO">Finalizado</option>
                    </select>
                </div>
                <div id="trimestres-list" class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>N√∫mero</th>
                                <th>Ficha</th>
                                <th>Programa</th>
                                <th>Fecha Inicio</th>
                                <th>Fecha Fin</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="trimestres-tbody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Evaluaciones -->
            <div id="evaluaciones" class="section">
                <h1>Gestionar Reportes</h1>
                <div style="display: flex; gap: 10px; margin-bottom: 20px; align-items: center;">
                    <button class="btn-primary" onclick="openModal('modal-crear-evaluacion')">
                         + Nuevo Reporte
                     </button>
                    <button class="btn-secondary" style="background-color: #d32f2f; color: white; display: flex; align-items: center; gap: 8px;" onclick="descargarEvaluacionesPDF()">
                        üìÑ Descargar PDF
                    </button>
                    <button class="btn-secondary" style="background-color: #388e3c; color: white; display: flex; align-items: center; gap: 8px;" onclick="descargarEvaluacionesExcel()">
                        üìä Descargar Excel
                    </button>
                </div>
                <div class="filters">
                    <input type="text" id="evaluaciones-search" placeholder="Buscar evaluaci√≥n...">
                    <select id="evaluaciones-gaes-filter">
                        <option value="">Todos los GAES</option>
                    </select>
                    <select id="evaluaciones-evaluador-filter">
                        <option value="">Todos los evaluadores</option>
                    </select>
                </div>
                <div id="evaluaciones-list" class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Aprendiz</th>
                                <th>GAES</th>
                                <th>Evaluador</th>
                                <th>Calificaci√≥n</th>
                                <th>Fecha</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="evaluaciones-tbody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Roles -->
            <div id="roles" class="section">
                <h1>Gestionar Roles</h1>
                <button class="btn-primary" onclick="openModal('modal-crear-rol')">
                    + Nuevo Rol
                </button>
                <div class="filters" style="margin-top: 15px;">
                    <input type="text" id="roles-search" placeholder="Buscar rol...">
                </div>
                <div id="roles-list" class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nombre del Rol</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="roles-tbody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Configuraci√≥n -->
            <div id="configuracion" class="section">
                <h1>Configuraci√≥n del Sistema</h1>
                <div class="settings-grid">
                    <button class="btn-secondary" onclick="openModal('modal-cambiar-contrasena')">
                        üîê Cambiar Contrase√±a
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODALES -->
    <!-- Modal Crear Usuario -->
    <div id="modal-crear-usuario" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Crear Usuario</h2>
                <button class="modal-close" onclick="closeModal('modal-crear-usuario')">&times;</button>
            </div>
            <form id="form-crear-usuario" class="form-group" onsubmit="crearUsuario(event)">
                <label>Nombre *</label>
                <input type="text" id="usuario-nombre" required>
                
                <label>Apellido *</label>
                <input type="text" id="usuario-apellido" required>
                
                <label>Correo *</label>
                <input type="email" id="usuario-correo" required>
                
                <label>Tipo Documento *</label>
                <select id="usuario-tipo-documento" required>
                    <option value="">Seleccione</option>
                    <option value="CC">C√©dula de Ciudadan√≠a</option>
                    <option value="CE">C√©dula de Extranjer√≠a</option>
                    <option value="TI">Tarjeta de Identidad</option>
                    <option value="PA">Pasaporte</option>
                </select>
                
                <label>N√∫mero Documento *</label>
                <input type="number" id="usuario-numero-documento" required>
                
                <label>Rol *</label>
                <select id="usuario-rol" required>
                    <option value="">Seleccione rol</option>
                </select>
                
                <label>Estado</label>
                <select id="usuario-estado">
                    <option value="ACTIVO">Activo</option>
                    <option value="INACTIVO">Inactivo</option>
                </select>
                
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">Crear Usuario</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('modal-crear-usuario')">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Editar Usuario -->
    <div id="modal-editar-usuario" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Editar Usuario</h2>
                <button class="modal-close" onclick="closeModal('modal-editar-usuario')">&times;</button>
            </div>
            <form id="form-editar-usuario" class="form-group" onsubmit="actualizarUsuario(event)">
                <input type="hidden" id="usuario-id-edit">
                
                <label>Nombre *</label>
                <input type="text" id="usuario-nombre-edit" required>
                
                <label>Apellido *</label>
                <input type="text" id="usuario-apellido-edit" required>
                
                <label>Correo *</label>
                <input type="email" id="usuario-correo-edit" required>
                
                <label>Tipo Documento *</label>
                <select id="usuario-tipo-documento-edit" required>
                    <option value="">Seleccione</option>
                    <option value="CC">C√©dula de Ciudadan√≠a</option>
                    <option value="CE">C√©dula de Extranjer√≠a</option>
                    <option value="TI">Tarjeta de Identidad</option>
                    <option value="PA">Pasaporte</option>
                </select>
                
                <label>N√∫mero Documento *</label>
                <input type="number" id="usuario-numero-documento-edit" required>
                
                <label>Rol *</label>
                <select id="usuario-rol-edit" required>
                    <option value="">Seleccione rol</option>
                </select>
                
                <label>Estado</label>
                <select id="usuario-estado-edit">
                    <option value="ACTIVO">Activo</option>
                    <option value="INACTIVO">Inactivo</option>
                </select>
                
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">Guardar Cambios</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('modal-editar-usuario')">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Crear Aprendiz -->
    <div id="modal-crear-aprendiz" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Crear Aprendiz</h2>
                <button class="modal-close" onclick="closeModal('modal-crear-aprendiz')">&times;</button>
            </div>
            <form id="form-crear-aprendiz" class="form-group" onsubmit="crearAprendiz(event)">
                <label>Usuario *</label>
                <select id="aprendiz-usuario" required>
                    <option value="">Seleccione usuario</option>
                </select>
                
                <label>Ficha (opcional - puede asignarse despu√©s)</label>
                <select id="aprendiz-ficha">
                    <option value="">Dejar vac√≠o para asignar despu√©s</option>
                </select>
                
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">Crear Aprendiz</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('modal-crear-aprendiz')">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Editar Aprendiz -->
    <div id="modal-editar-aprendiz" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Editar Aprendiz</h2>
                <button class="modal-close" onclick="closeModal('modal-editar-aprendiz')">&times;</button>
            </div>
            <form id="form-editar-aprendiz" class="form-group" onsubmit="actualizarAprendiz(event)">
                <input type="hidden" id="aprendiz-id-edit">
                
                <label>Usuario *</label>
                <select id="aprendiz-usuario-edit" required>
                    <option value="">Seleccione usuario</option>
                </select>
                
                <label>Ficha *</label>
                <select id="aprendiz-ficha-edit" required>
                    <option value="">Seleccione ficha</option>
                </select>
                
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">Guardar Cambios</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('modal-editar-aprendiz')">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Crear Ficha -->
    <div id="modal-crear-ficha" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Crear Ficha</h2>
                <button class="modal-close" onclick="closeModal('modal-crear-ficha')">&times;</button>
            </div>
            <form id="form-crear-ficha" class="form-group" onsubmit="crearFicha(event)">
                <label>C√≥digo Ficha *</label>
                <input type="text" id="ficha-codigo" placeholder="Ej: SENA-2024-001" required>
                
                <label>Programa de Formaci√≥n *</label>
                <input type="text" id="ficha-programa" required>
                
                <label>Jornada *</label>
                <select id="ficha-jornada" required>
                    <option value="">Seleccione</option>
                    <option value="MA√ëANA">Ma√±ana</option>
                    <option value="TARDE">Tarde</option>
                    <option value="NOCHE">Noche</option>
                    <option value="COMPLETA">Completa</option>
                </select>
                
                <label>Modalidad *</label>
                <select id="ficha-modalidad" required>
                    <option value="">Seleccione</option>
                    <option value="PRESENCIAL">Presencial</option>
                    <option value="VIRTUAL">Virtual</option>
                    <option value="HIBRIDA">H√≠brida</option>
                </select>
                
                <label>Fecha Inicio *</label>
                <input type="date" id="ficha-inicio" required>
                
                <label>Fecha Fin *</label>
                <input type="date" id="ficha-fin" required>
                
                <label>Estado</label>
                <select id="ficha-estado">
                    <option value="ACTIVO">Activo</option>
                    <option value="INACTIVO">Inactivo</option>
                    <option value="FINALIZADO">Finalizado</option>
                </select>
                
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">Crear Ficha</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('modal-crear-ficha')">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Editar Ficha -->
    <div id="modal-editar-ficha" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Editar Ficha</h2>
                <button class="modal-close" onclick="closeModal('modal-editar-ficha')">&times;</button>
            </div>
            <form id="form-editar-ficha" class="form-group" onsubmit="actualizarFicha(event)">
                <input type="hidden" id="ficha-id-edit">
                
                <label>C√≥digo Ficha *</label>
                <input type="text" id="ficha-codigo-edit" required>
                
                <label>Programa de Formaci√≥n *</label>
                <input type="text" id="ficha-programa-edit" required>
                
                <label>Jornada *</label>
                <select id="ficha-jornada-edit" required>
                    <option value="">Seleccione</option>
                    <option value="MA√ëANA">Ma√±ana</option>
                    <option value="TARDE">Tarde</option>
                    <option value="NOCHE">Noche</option>
                    <option value="COMPLETA">Completa</option>
                </select>
                
                <label>Modalidad *</label>
                <select id="ficha-modalidad-edit" required>
                    <option value="">Seleccione</option>
                    <option value="PRESENCIAL">Presencial</option>
                    <option value="VIRTUAL">Virtual</option>
                    <option value="HIBRIDA">H√≠brida</option>
                </select>
                
                <label>Fecha Inicio *</label>
                <input type="date" id="ficha-inicio-edit" required>
                
                <label>Fecha Fin *</label>
                <input type="date" id="ficha-fin-edit" required>
                
                <label>Estado</label>
                <select id="ficha-estado-edit">
                    <option value="ACTIVO">Activo</option>
                    <option value="INACTIVO">Inactivo</option>
                    <option value="FINALIZADO">Finalizado</option>
                </select>
                
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">Guardar Cambios</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('modal-editar-ficha')">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>



    <!-- Modal Crear Evaluaci√≥n -->
    <div id="modal-crear-evaluacion" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Crear Reporte</h2>
                <button class="modal-close" onclick="closeModal('modal-crear-evaluacion')">&times;</button>
            </div>
            <form id="form-crear-evaluacion" class="form-group" onsubmit="crearEvaluacion(event)">
                <label>Aprendiz *</label>
                <select id="evaluacion-aprendiz" required>
                    <option value="">Seleccione aprendiz</option>
                </select>
                
                <label>GAES *</label>
                <select id="evaluacion-gaes" required>
                    <option value="">Seleccione GAES</option>
                </select>
                
                <label>Evaluador (Instructor) *</label>
                <select id="evaluacion-evaluador" required>
                    <option value="">Seleccione evaluador</option>
                </select>
                
                <label>Rango de Calificaci√≥n *</label>
                <select id="evaluacion-rango" required onchange="actualizarRangoCalificacion('evaluacion-calificacion', 'evaluacion-rango')">
                    <option value="">Seleccione rango</option>
                    <option value="5">0.00 - 5.00</option>
                    <option value="100">1 - 100</option>
                </select>
                
                <label>Calificaci√≥n *</label>
                <input type="number" id="evaluacion-calificacion" step="0.01" min="0" max="5" required>
                
                <label>Observaciones</label>
                <textarea id="evaluacion-observaciones" placeholder="Comentarios sobre el reporte" rows="3"></textarea>
                
                <label>Fecha *</label>
                <input type="date" id="evaluacion-fecha" required>
                
                <div class="modal-actions">
                     <button type="submit" class="btn-primary">Crear Reporte</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('modal-crear-evaluacion')">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Editar Evaluaci√≥n -->
    <div id="modal-editar-evaluacion" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Editar Evaluaci√≥n</h2>
                <button class="modal-close" onclick="closeModal('modal-editar-evaluacion')">&times;</button>
            </div>
            <form id="form-editar-evaluacion" class="form-group" onsubmit="actualizarEvaluacion(event)">
                <input type="hidden" id="evaluacion-id-edit">
                
                <label>Aprendiz *</label>
                <select id="evaluacion-aprendiz-edit" required>
                    <option value="">Seleccione aprendiz</option>
                </select>
                
                <label>GAES *</label>
                <select id="evaluacion-gaes-edit" required>
                    <option value="">Seleccione GAES</option>
                </select>
                
                <label>Evaluador (Instructor) *</label>
                <select id="evaluacion-evaluador-edit" required>
                    <option value="">Seleccione evaluador</option>
                </select>
                
                <label>Rango de Calificaci√≥n *</label>
                <select id="evaluacion-rango-edit" required onchange="actualizarRangoCalificacion('evaluacion-calificacion-edit', 'evaluacion-rango-edit')">
                    <option value="">Seleccione rango</option>
                    <option value="5">0.00 - 5.00</option>
                    <option value="100">1 - 100</option>
                </select>
                
                <label>Calificaci√≥n *</label>
                <input type="number" id="evaluacion-calificacion-edit" step="0.01" min="0" max="5" required>
                
                <label>Observaciones</label>
                <textarea id="evaluacion-observaciones-edit" rows="3"></textarea>
                
                <label>Fecha *</label>
                <input type="date" id="evaluacion-fecha-edit" required>
                
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">Guardar Cambios</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('modal-editar-evaluacion')">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Crear Trimestre -->
    <div id="modal-crear-trimestre" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Crear Trimestre</h2>
                <button class="modal-close" onclick="closeModal('modal-crear-trimestre')">&times;</button>
            </div>
            <form id="form-crear-trimestre" class="form-group" onsubmit="crearTrimestre(event)">
                <label>N√∫mero Trimestre *</label>
                <select id="trimestre-numero" required>
                    <option value="">Seleccione</option>
                    <option value="1">Trimestre 1</option>
                    <option value="2">Trimestre 2</option>
                    <option value="3">Trimestre 3</option>
                    <option value="4">Trimestre 4</option>
                    <option value="5">Trimestre 5</option>
                    <option value="6">Trimestre 6</option>
                    <option value="7">Trimestre 7</option>
                    <option value="8">Trimestre 8</option>
                    <option value="9">Trimestre 9</option>
                    <option value="10">Trimestre 10</option>
                </select>
                
                <label>Ficha *</label>
                <input type="text" id="trimestre-ficha-search" placeholder="Buscar ficha por c√≥digo o programa..." style="margin-bottom: 10px;">
                <select id="trimestre-ficha" required>
                    <option value="">Seleccione una ficha</option>
                </select>
                
                <label>Fecha Inicio *</label>
                <input type="date" id="trimestre-inicio" required>
                
                <label>Fecha Fin *</label>
                <input type="date" id="trimestre-fin" required>
                
                <label>Estado</label>
                <select id="trimestre-estado">
                    <option value="ACTIVO">Activo</option>
                    <option value="INACTIVO">Inactivo</option>
                    <option value="FINALIZADO">Finalizado</option>
                </select>
                
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">Crear Trimestre</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('modal-crear-trimestre')">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Editar Trimestre -->
    <div id="modal-editar-trimestre" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Editar Trimestre</h2>
                <button class="modal-close" onclick="closeModal('modal-editar-trimestre')">&times;</button>
            </div>
            <form id="form-editar-trimestre" class="form-group" onsubmit="actualizarTrimestre(event)">
                <input type="hidden" id="trimestre-id-edit">
                
                <label>N√∫mero Trimestre *</label>
                <select id="trimestre-numero-edit" required>
                    <option value="">Seleccione</option>
                    <option value="1">Trimestre 1</option>
                    <option value="2">Trimestre 2</option>
                    <option value="3">Trimestre 3</option>
                    <option value="4">Trimestre 4</option>
                    <option value="5">Trimestre 5</option>
                    <option value="6">Trimestre 6</option>
                    <option value="7">Trimestre 7</option>
                    <option value="8">Trimestre 8</option>
                    <option value="9">Trimestre 9</option>
                    <option value="10">Trimestre 10</option>
                </select>
                
                <label>Ficha *</label>
                <input type="text" id="trimestre-ficha-search-edit" placeholder="Buscar ficha por c√≥digo o programa..." style="margin-bottom: 10px;">
                <select id="trimestre-ficha-edit" required>
                    <option value="">Seleccione una ficha</option>
                </select>
                
                <label>Fecha Inicio *</label>
                <input type="date" id="trimestre-inicio-edit" required>
                
                <label>Fecha Fin *</label>
                <input type="date" id="trimestre-fin-edit" required>
                
                <label>Estado</label>
                <select id="trimestre-estado-edit">
                    <option value="ACTIVO">Activo</option>
                    <option value="INACTIVO">Inactivo</option>
                    <option value="FINALIZADO">Finalizado</option>
                </select>
                
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">Guardar Cambios</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('modal-editar-trimestre')">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>



    <!-- Modal Crear Instructor -->
    <div id="modal-crear-instructor" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Crear Instructor</h2>
                <button class="modal-close" onclick="closeModal('modal-crear-instructor')">&times;</button>
            </div>
            <form id="form-crear-instructor" class="form-group" onsubmit="crearInstructor(event)">
                <label>Usuario *</label>
                <select id="instructor-usuario" required>
                    <option value="">Seleccione un usuario</option>
                </select>
                
                <label>Ficha a Cargo *</label>
                <select id="instructor-ficha" required>
                    <option value="">Seleccione una ficha</option>
                </select>
                
                <label>Especialidad</label>
                <input type="text" id="instructor-especialidad" placeholder="Ej: Programaci√≥n, Redes, etc.">
                
                <label>Estado</label>
                <select id="instructor-estado">
                    <option value="ACTIVO">ACTIVO</option>
                    <option value="INACTIVO">INACTIVO</option>
                </select>
                
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">Crear Instructor</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('modal-crear-instructor')">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Editar Instructor -->
    <div id="modal-editar-instructor" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Editar Instructor</h2>
                <button class="modal-close" onclick="closeModal('modal-editar-instructor')">&times;</button>
            </div>
            <form id="form-editar-instructor" class="form-group" onsubmit="actualizarInstructor(event)">
                <input type="hidden" id="instructor-id-edit">
                
                <label>Usuario *</label>
                <select id="instructor-usuario-edit" required>
                    <option value="">Seleccione un usuario</option>
                </select>
                
                <label>Ficha a Cargo *</label>
                <select id="instructor-ficha-edit" required>
                    <option value="">Seleccione una ficha</option>
                </select>
                
                <label>Especialidad</label>
                <input type="text" id="instructor-especialidad-edit" placeholder="Ej: Programaci√≥n, Redes, etc.">
                
                <label>Estado</label>
                <select id="instructor-estado-edit">
                    <option value="ACTIVO">ACTIVO</option>
                    <option value="INACTIVO">INACTIVO</option>
                </select>
                
                <div class="modal-actions">
                    <button type="submit" class="btn-primary">Guardar Cambios</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('modal-editar-instructor')">
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Crear Rol -->
    <div id="modal-crear-rol" class="modal">
         <div class="modal-content">
             <div class="modal-header">
                 <h2>Crear Rol</h2>
                 <button class="modal-close" onclick="closeModal('modal-crear-rol')">&times;</button>
             </div>
             <form id="form-crear-rol" class="form-group" onsubmit="crearRol(event)">
                 <label>Nombre del Rol *</label>
                 <input type="text" id="rol-nombre" placeholder="Ej: Instructor, Coordinador, etc." required>
                 
                 <div class="modal-actions">
                     <button type="submit" class="btn-primary">Crear Rol</button>
                     <button type="button" class="btn-secondary" onclick="closeModal('modal-crear-rol')">
                         Cancelar
                     </button>
                 </div>
             </form>
         </div>
     </div>

    <!-- Modal Editar Rol -->
    <div id="modal-editar-rol" class="modal">
         <div class="modal-content">
             <div class="modal-header">
                 <h2>Editar Rol</h2>
                 <button class="modal-close" onclick="closeModal('modal-editar-rol')">&times;</button>
             </div>
             <form id="form-editar-rol" class="form-group" onsubmit="actualizarRol(event)">
                 <input type="hidden" id="rol-id-edit">
                 
                 <label>Nombre del Rol *</label>
                 <input type="text" id="rol-nombre-edit" required>
                 
                 <div class="modal-actions">
                     <button type="submit" class="btn-primary">Guardar Cambios</button>
                     <button type="button" class="btn-secondary" onclick="closeModal('modal-editar-rol')">
                         Cancelar
                     </button>
                 </div>
             </form>
         </div>
     </div>

    <!-- Modal Mi Perfil -->
    <div id="modal-mi-perfil" class="modal">
         <div class="modal-content" style="max-width: 600px;">
             <div class="modal-header">
                 <h2>Mi Perfil</h2>
                 <button class="modal-close" onclick="closeModal('modal-mi-perfil')">&times;</button>
             </div>
             <div style="padding: 20px;">
                 <div style="text-align: center; margin-bottom: 30px;">
                     <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 32px; font-weight: bold; margin: 0 auto; margin-bottom: 15px;" id="profile-avatar">JA</div>
                     <h3 id="profile-nombre">Cargando...</h3>
                     <p id="profile-correo" style="color: #666; margin: 5px 0;">Cargando...</p>
                     <p id="profile-rol" style="color: #999; font-size: 14px;">Cargando...</p>
                 </div>
                 
                 <form id="form-mi-perfil" class="form-group" onsubmit="actualizarMiPerfil(event)">
                     <label>Nombre *</label>
                     <input type="text" id="perfil-nombre" required>
                     
                     <label>Apellido *</label>
                     <input type="text" id="perfil-apellido" required>
                     
                     <label>Correo *</label>
                     <input type="email" id="perfil-correo" required>
                     
                     <label>Tipo Documento</label>
                     <select id="perfil-tipo-documento">
                         <option value="CC">C√©dula de Ciudadan√≠a</option>
                         <option value="CE">C√©dula de Extranjer√≠a</option>
                         <option value="TI">Tarjeta de Identidad</option>
                         <option value="PA">Pasaporte</option>
                     </select>
                     
                     <label>N√∫mero Documento</label>
                     <input type="number" id="perfil-numero-documento">
                     
                     <div class="modal-actions">
                         <button type="submit" class="btn-primary">Guardar Cambios</button>
                         <button type="button" class="btn-secondary" onclick="closeModal('modal-mi-perfil')">
                             Cancelar
                         </button>
                     </div>
                 </form>
             </div>
         </div>
         </div>

         <!-- Cargar utilidades de API y autenticaci√≥n PRIMERO (antes de cualquier script inline) -->
         <script src="/js/api-utils.js"></script>
         
         <!-- Actualizar header con datos del usuario autenticado -->
         <script src="/js/actualizar-header-usuario.js"></script>

         <script>
            // Validar autenticaci√≥n antes de cargar el dashboard
            function validarAutenticacion() {
            const token = localStorage.getItem('jwtToken');
            const rol = localStorage.getItem('usuarioRol');
            
            console.log('Token:', token ? 'Existe' : 'No existe');
            console.log('Rol guardado:', rol);
            
            // Si no hay token, redirigir al login
            if (!token || !token.trim()) {
                console.log('No hay token, redirigiendo al login');
                window.location.href = '/login';
                return false;
            }
            
            // Validar que sea administrador (case-insensitive)
            if (rol && rol.toLowerCase() !== 'administrador') {
                console.log('Rol no permitido:', rol);
                window.location.href = '/login';
                return false;
            }
            
            console.log('‚úì Usuario administrador autenticado correctamente');
            return true;
        }
        
        // Ejecutar validaci√≥n
        validarAutenticacion();
        </script>

        <!-- Prevenci√≥n de Back Navigation - DEBE SER PRIMERO -->
        <script src="/js/prevent-back-navigation.js"></script>
        
        <!-- Cargar inicializaci√≥n global -->
        <script src="/js/app-init.js"></script>
     
     <!-- Gr√°ficos din√°micos administrativos -->
     <script src="/js/admin-charts.js"></script>
     
     <!-- Luego cargar los m√≥dulos CRUD -->
     <script src="/js/administrador-dashboard.js"></script>
    <script src="/js/admin-instructores.js"></script>
    <script src="/js/mi-perfil.js"></script>
    <script src="/js/usuarios-crud.js"></script>
    <script src="/js/fichas-crud.js"></script>
    <script src="/js/trimestres-crud.js"></script>
    <script src="/js/evaluaciones-crud.js"></script>
    <script src="/js/roles-crud.js"></script>
    <script src="/js/aprendiz-crud.js"></script>
    <script src="/js/instructores-crud.js"></script>
    </body>
    </html>
